package net.believecollective.ag2010.patterns.proxy {	import org.puremvc.as3.interfaces.IProxy;	import org.puremvc.as3.patterns.proxy.Proxy;	import flash.net.SharedObject;	/**	 * @author Dan Mackie (dan@believecollective.net)	 */	public class HistoryProxy extends Proxy implements IProxy {		public static const NAME : String = "HistoryProxy";				var _oHistory:SharedObject;		var _bReturningUser : Boolean;		var _oNow : Date;				public function HistoryProxy() {			super(NAME);			// retrieve or create the shared object			_oHistory = SharedObject.getLocal("agtimeline");						_oNow = new Date();						if (_oHistory.data.date){				// this is not the first visit				var t_bSameDay : Boolean = true;				var t_oPast : Date = _oHistory.data.date;				if (_oNow.day != t_oPast.day) {					// different day as previous visit					fResetData();				}				else if (_oNow.month != t_oPast.month) {					// same day but different month as previous visit					fResetData();				}				else if (_oNow.year != t_oPast.year) {					// same day and month but different year as previous visit					fResetData();				}				else {					_bReturningUser = true;					_oHistory.data.bustTimelineCache = false;				}							} else {				// this is the first visit				fResetData();			}						// ***************			// for testing 			fResetData(); // each load of the swf behaves as if it were the first			// ****************		}		private function fResetData() : void {			_bReturningUser = false; // help screen will be shown			_oHistory.clear();			_oHistory = SharedObject.getLocal("agtimeline");			_oHistory.data.returningUser = true; //  set for next time			_oHistory.data.date = _oNow; // set for next time			_oHistory.data.showFeedback = true; //  set for next time			_oHistory.data.eventIDs = new Array(); // navigation history is cleared			_oHistory.data.detailVOs = new Array(); // detail VO's are cleared						//// VISIBILITY OF TIMELINES			// 	default is Nepal and Gurkha only			// 	TimelineViewGFX.TIMELINE_NAMES : Array = [			//											TIMELINE_NAME_NEPAL,			//											TIMELINE_NAME_GURKHAS,			//											TIMELINE_NAME_WALES,			//											TIMELINE_NAME_UK,			//											TIMELINE_NAME_WORLD,			//											TIMELINE_NAME_WORLD ]; 			_oHistory.data.timelinesVis = new Array(													true, 													true, 													false, 													false, 													false,													false);	
		}
				//////// GETTERS						public function get historyObject () : SharedObject {			return _oHistory;		}				public function get returningUser() : Boolean {			return _bReturningUser;		}	}}